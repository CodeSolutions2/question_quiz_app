<!DOCTYPE html>
<html>
<head></head>
    
<body>
    <div id="btns" class="buttonContainer">
        <button id="btn0" class="buttonClass">Question 0</button>
        <button id="btn1" class="buttonClass">Question 1</button>
        <button id="btn2" class="buttonClass">Question 2</button>
        <button id="btn3" class="buttonClass">Question 3</button>
    </div>
	
<button id="load_a_test" onclick="load_a_test" style="display:block;">Load a test</button>
  
<div id="notification"></div>
<div id="error"></div>

<!-- --------------------------------------------------- -->

<!-- CSS -->
<style>
div { padding: 10px; display:block; font-family:courier; font-size:15px; height:300px; }
div#notification { position: relative; color: #3236a8; }
div#error { position: relative; color: #bd1f17; }

.buttonContainer { width: 75%; display: flex; flex-direction: column; justify-content: flex-start; flex-wrap: wrap; }
.buttonContainer > .buttonClass { width: 100px; height: 48px; font-size: 12px; text-wrap: wrap; }
</style>
	
<!-- --------------------------------------------------- -->
  
<script>

// Force the page to refresh the cached webpage
window.addEventListener('beforeunload', function() {
 	window.location.href = window.location.href + '?nocache=' + new Date().getTime();
});


// 
	
// ----------------------------------------------------

const foldername = "Q_Git";
const repo_name = "question_quiz_app";
const repoOwner = "CodeSolutions2";
const branchName = "main";

// ----------------------------------------------------

// Initially load the questions from the repository
const file_obj = async () => { const out = await GET_fileobjects_for_a_folder(foldername, repo_name, repoOwner, branchName); return out; };
console.log('file_obj: ', file_obj);

var x = Array.from({ length: file_obj.length }, (_, ind) => ind);
console.log('x: ', x);
	
var x_rand = async () => { await rand_perm(x);  }
console.log('x_rand: ', x_rand);

// ----------------------------------------------------
	
document.getElementById("load_a_test").addEventListener("click", async () => {

	console.log('button clicked');

	if (x_rand.length > 0) {
		var text = await GET_repo_file_info_RESTAPI_fast(repoOwner, repo_name, branchName, foldername, file_obj[x_rand.shift()].name);
		console.log('text: ', text);
		
		const NonEmptyVals_toKeep = (x) => x.length != 0;
		var QandA_list = text.split('\n').filter(NonEmptyVals_toKeep);
		console.log('QandA_list: ', QandA_list);
		
		var A = QandA_list.map((x, ind) => {
			if (ind < QandA_list.length-1) {
				document.getElementById(`btn${ind}`).innerText = x;
				return '';
			} else {
				return x;
			}
		});
	
		// Answer
		 A = A.filter(NonEmptyVals_toKeep).at(0);
		console.log('A: ', A);
	} else {
		document.getElementById("notification").innerHTML = "All questions have been used. Please push Restart to restart."
	}
	
});


// async function load_a_test() { }

// ----------------------------------------------------

async function GET_fileobjects_for_a_folder(repoOwner, repo_name, foldername, branchName) {

	// Using url
	return await fetch(`https://api.github.com/repos/${repoOwner}/${repo_name}/contents/${foldername}?ref=${branchName}`)
		.then(res => res.json())
		.then(async function(data) { return data; })
		.catch(error => { console.log(error); });
}
  
// ----------------------------------------------------
  
async function GET_repo_file_info_RESTAPI_fast(repoOwner, repo_name, branchName, foldername, filename) {
	
	// Using download_url
	return await fetch(`https://raw.githubusercontent.com/${repoOwner}/${repo_name}/${branchName}/${foldername}/${filename}`)
		.then(res => res.text())
		.then(async function (text_out) { return  text_out; })
		.catch(error => { console.log(error); });
}

// ----------------------------------------------------

async function get_number(x) {
	return x[Math.round(x.length*Math.random())-1];
}
	  
async function rand_perm(x) {

	var out = [];
	while (out.length != x.length) {
		out = await get_number(x).then(async function(x_of_y) {
			if (out.includes(x_of_y) == false && typeof x_of_y != "undefined") { 
				out.push(x_of_y);
			}
			return [... new Set(out)]; // ensure that only unique values are stored in out
		});
	}
	
	return out;

// ----------------------------------------------------

	
}  // end of rand_perm

</script>
</body>
</html>
